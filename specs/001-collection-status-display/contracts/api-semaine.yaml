openapi: 3.0.3
info:
  title: Waste Collection Current Week API
  description: |
    API endpoint for retrieving the current week's waste collection schedule.
    Returns collection dates falling between Monday and Sunday of the current week
    with collection type indicators (yellow bin, grey bin, or both).

    **User Story**: P1 - Check Current Week Collection Status
    **Performance**: < 200ms response time (per Technical Context)
    **Timezone**: All dates in Europe/Paris timezone
  version: 1.0.0
  contact:
    name: Municipality Technical Support
    email: support@pont-sur-yonne.fr

servers:
  - url: http://localhost:3000/api
    description: Development server
  - url: https://collecte-poubelles.vercel.app/api
    description: Production server (Vercel)

paths:
  /semaine:
    get:
      summary: Get current week collection schedule
      description: |
        Returns all waste collection dates for the current week (Monday-Sunday).
        Week boundaries use ISO 8601 standard (Monday = start of week).

        **Caching**: `export const dynamic = 'force-dynamic'` (never cached)
        **Index Used**: `idx_date` (date range query)
      operationId: getCurrentWeekCollections
      tags:
        - Collections
      responses:
        '200':
          description: Successful response with current week collection data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SemaineResponse'
              examples:
                weekWithBothBins:
                  summary: Week with both yellow and grey collections
                  value:
                    semaine:
                      debut: "2025-11-10"
                      fin: "2025-11-16"
                      aujourdhui: "2025-11-12"
                    collectes:
                      - id: 245
                        date: "2025-11-12"
                        typeCollecte: "jaune"
                        annee: 2025
                        mois: 11
                        jour: 12
                        estFerie: false
                        description: "Collecte bac jaune - Emballages et papiers"
                      - id: 246
                        date: "2025-11-15"
                        typeCollecte: "gris"
                        annee: 2025
                        mois: 11
                        jour: 15
                        estFerie: false
                        description: "Collecte bac gris - Ordures ménagères"
                    aCollecteJaune: true
                    aCollecteGrise: true
                weekNoCollections:
                  summary: Week with no collections
                  value:
                    semaine:
                      debut: "2025-11-03"
                      fin: "2025-11-09"
                      aujourdhui: "2025-11-05"
                    collectes: []
                    aCollecteJaune: false
                    aCollecteGrise: false
                weekHolidayCollection:
                  summary: Week with holiday collection
                  value:
                    semaine:
                      debut: "2024-12-30"
                      fin: "2025-01-05"
                      aujourdhui: "2025-01-01"
                    collectes:
                      - id: 1
                        date: "2025-01-01"
                        typeCollecte: "gris"
                        annee: 2025
                        mois: 1
                        jour: 1
                        estFerie: true
                        description: "Collecte bac gris - Ordures ménagères"
                    aCollecteJaune: false
                    aCollecteGrise: true
        '500':
          description: Database error or server failure
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Erreur lors de la récupération des collectes"
                code: "DB_CONNECTION_ERROR"
                timestamp: "2025-11-12T14:30:00Z"
        '503':
          description: Service temporarily unavailable (maintenance mode)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Service en maintenance"
                code: "MAINTENANCE_MODE"
                timestamp: "2025-11-12T02:00:00Z"
                retryAfter: 3600

components:
  schemas:
    SemaineResponse:
      type: object
      required:
        - semaine
        - collectes
        - aCollecteJaune
        - aCollecteGrise
      properties:
        semaine:
          $ref: '#/components/schemas/Semaine'
        collectes:
          type: array
          items:
            $ref: '#/components/schemas/Collecte'
          description: Array of collections occurring this week (may be empty)
        aCollecteJaune:
          type: boolean
          description: True if any collection this week involves yellow bin
          example: true
        aCollecteGrise:
          type: boolean
          description: True if any collection this week involves grey bin
          example: true

    Semaine:
      type: object
      required:
        - debut
        - fin
        - aujourdhui
      properties:
        debut:
          type: string
          format: date
          description: Week start date (Monday) in ISO 8601 format
          example: "2025-11-10"
        fin:
          type: string
          format: date
          description: Week end date (Sunday) in ISO 8601 format
          example: "2025-11-16"
        aujourdhui:
          type: string
          format: date
          description: Current date in ISO 8601 format
          example: "2025-11-12"

    Collecte:
      type: object
      required:
        - id
        - date
        - typeCollecte
        - annee
        - mois
        - jour
        - estFerie
      properties:
        id:
          type: integer
          description: Database primary key
          example: 245
        date:
          type: string
          format: date
          description: Collection date in ISO 8601 format (YYYY-MM-DD)
          example: "2025-11-12"
        typeCollecte:
          type: string
          enum: [jaune, gris, both]
          description: Type of waste collection
          example: "jaune"
        annee:
          type: integer
          minimum: 2025
          maximum: 2025
          description: Year (currently 2025 only per Clarification #4)
          example: 2025
        mois:
          type: integer
          minimum: 1
          maximum: 12
          description: Month (1-12)
          example: 11
        jour:
          type: integer
          minimum: 1
          maximum: 31
          description: Day of month
          example: 12
        estFerie:
          type: boolean
          description: True if collection falls on a public holiday
          example: false
        description:
          type: string
          nullable: true
          maxLength: 100
          description: Human-readable collection description in French
          example: "Collecte bac jaune - Emballages et papiers"

    ErrorResponse:
      type: object
      required:
        - error
        - code
        - timestamp
      properties:
        error:
          type: string
          description: Human-readable error message in French
          example: "Erreur lors de la récupération des collectes"
        code:
          type: string
          description: Machine-readable error code
          example: "DB_CONNECTION_ERROR"
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp of error
          example: "2025-11-12T14:30:00Z"
        retryAfter:
          type: integer
          description: Seconds to wait before retrying (for 503 errors)
          example: 3600

  securitySchemes: {}

tags:
  - name: Collections
    description: Waste collection schedule endpoints
